
import glob
import numpy as np
import matplotlib.pyplot as plt

def read_features(feature_set_path):
    """
    read feature data into a list
    :param feature_set_path: the folder which keeps feature files
    :return: list: features, target
    """
    features = list()
    target = list()
    feature_paths = glob.glob(feature_set_path + "\\*")

    for path in feature_paths:
        with open(path) as f:
            for line in f:
                feature = list()
                split = line.split('\t')
                for cof in split:
                    if 'normal' in cof:
                        target.append('normal')
                    elif 'botnet' in cof:
                        target.append('botnet')
                    else:
                        feature.append(float(cof))
                features.append(feature)
            f.close()

    return features, target


feature_set_path = "D:\\Work\PyCharm-workspace\\MalwareTrafficDetection\\Dataset\\features"
features, target = read_features(feature_set_path)
target_botnet = []
target_normal = []
features_botnet = []
features_normal = []
for i in range(0,len(target)):
    if target[i]=='botnet':
        target_botnet.append(target[i])
        features_botnet.append(features[i])
    else:
        target_normal.append(target[i])
        features_normal.append(features[i])

features_botnet = np.array(features_botnet)
features_normal = np.array(features_normal)

# #>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# #-----------------------------------------------------------------
# #conn_duration: mean/standard deviation/standard deviation range
# plt.figure(1)
#
# plt.subplot(5,1,1)
# plt.title('CONN Duration Mean')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,0], target_normal, '.')
# plt.plot(features_botnet[:,0], target_botnet, '.')
#
# plt.subplot(5,1,3)
# plt.title('CONN Duration Standard Deviation')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,1], target_normal, '.')
# plt.plot(features_botnet[:,1], target_botnet, '.')
#
# plt.subplot(5,1,5)
# plt.title('CONN Duration Standard Deviation Range')
# plt.xlabel('percentage')
# plt.plot(features_normal[:,2], target_normal, '.')
# plt.plot(features_botnet[:,2], target_botnet, '.')
#
# #-----------------------------------------------------------------
# #conn_orig_bytes: mean/standard deviation/standard deviation range
# plt.figure(2)
#
# plt.subplot(5,1,1)
# plt.title('CONN Original Bytes Mean')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,3], target_normal, '.')
# plt.plot(features_botnet[:,3], target_botnet, '.')
#
# plt.subplot(5,1,3)
# plt.title('CONN Original Bytes Standard Deviation')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,4], target_normal, '.')
# plt.plot(features_botnet[:,4], target_botnet, '.')
#
# plt.subplot(5,1,5)
# plt.title('CONN Original Bytes Standard Deviation Range')
# plt.xlabel('percentage')
# plt.plot(features_normal[:,5], target_normal, '.')
# plt.plot(features_botnet[:,5], target_botnet, '.')
#
# #-----------------------------------------------------------------
# #conn_resp_bytes: mean/standard deviation/standard deviation range
# plt.figure(3)
#
# plt.subplot(5,1,1)
# plt.title('CONN Response Bytes Mean')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,6], target_normal, '.')
# plt.plot(features_botnet[:,6], target_botnet, '.')
#
# plt.subplot(5,1,3)
# plt.title('CONN Response Bytes Standard Deviation')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,7], target_normal, '.')
# plt.plot(features_botnet[:,7], target_botnet, '.')
#
# plt.subplot(5,1,5)
# plt.title('CONN Response Bytes Standard Deviation Range')
# plt.xlabel('percentage')
# plt.plot(features_normal[:,8], target_normal, '.')
# plt.plot(features_botnet[:,8], target_botnet, '.')
#
# #-----------------------------------------------------------------
# #conn_orig_bytes_ratio
# plt.figure(4)
#
# plt.subplot()
# plt.title('CONN Original Bytes Ratio (OB/OB+RB)')
# plt.xlabel('percentage')
# plt.plot(features_normal[:,9], target_normal, '.')
# plt.plot(features_botnet[:,9], target_botnet, '.')
#
# #-----------------------------------------------------------------
# #conn_orig_pkts: mean/standard deviation/standard deviation range
# plt.figure(5)
#
# plt.subplot(5,1,1)
# plt.title('CONN Original Packets Mean')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,10], target_normal, '.')
# plt.plot(features_botnet[:,10], target_botnet, '.')
#
# plt.subplot(5,1,3)
# plt.title('CONN Original Packets Standard Deviation')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,11], target_normal, '.')
# plt.plot(features_botnet[:,11], target_botnet, '.')
#
# plt.subplot(5,1,5)
# plt.title('CONN Original Packets Standard Deviation Range')
# plt.xlabel('percentage')
# plt.plot(features_normal[:,12], target_normal, '.')
# plt.plot(features_botnet[:,12], target_botnet, '.')
#
# #-----------------------------------------------------------------
# #conn_resp_pkts: mean/standard deviation/standard deviation range
# plt.figure(6)
#
# plt.subplot(5,1,1)
# plt.title('CONN Response Packets Mean')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,13], target_normal, '.')
# plt.plot(features_botnet[:,13], target_botnet, '.')
#
# plt.subplot(5,1,3)
# plt.title('CONN Response Packets Standard Deviation')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,14], target_normal, '.')
# plt.plot(features_botnet[:,14], target_botnet, '.')
#
# plt.subplot(5,1,5)
# plt.title('CONN Response Packets Standard Deviation Range')
# plt.xlabel('percentage')
# plt.plot(features_normal[:,15], target_normal, '.')
# plt.plot(features_botnet[:,15], target_botnet, '.')
#
# #-----------------------------------------------------------------
# #conn_orig_pkts_ratio
# plt.figure(7)
#
# plt.subplot()
# plt.title('CONN Original Packets Ratio (OP/OP+RP)')
# plt.xlabel('percentage')
# plt.plot(features_normal[:,16], target_normal, '.')
# plt.plot(features_botnet[:,16], target_botnet, '.')
#
# #-----------------------------------------------------------------
# #conn_periodicity: mean/standard deviation/standard deviation range
# plt.figure(8)
#
# plt.subplot(5,1,1)
# plt.title('CONN Periodicity Mean')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,17], target_normal, '.')
# plt.plot(features_botnet[:,17], target_botnet, '.')
#
# plt.subplot(5,1,3)
# plt.title('CONN Periodicity Standard Deviation')
# plt.xlabel('time/ms')
# plt.plot(features_normal[:,18], target_normal, '.')
# plt.plot(features_botnet[:,18], target_botnet, '.')
#
# plt.subplot(5,1,5)
# plt.title('CONN Periodicity Standard Deviation Range')
# plt.xlabel('percentage')
# plt.plot(features_normal[:,19], target_normal, '.')
# plt.plot(features_botnet[:,19], target_botnet, '.')
#
# #-----------------------------------------------------------------
# #conn_state_ratio: [S0 S1 SF REJ S2 S3 RSTO RSTR RSTOS0 RSTRH SH SHR OTH]
# plt.figure(9)
#
# plt.subplot()
# plt.title('CONN State Ratio')
# plt.xlabel('percentage')
# plt.plot(features_normal[:,20], ['Normal_S0']*len(target_normal), 'b.')
# plt.plot(features_botnet[:,20], ['Botnet_S0']*len(target_botnet), 'b.')
# plt.plot(features_normal[:,21], ['Normal_S1']*len(target_normal), 'cx')
# plt.plot(features_botnet[:,21], ['Botnet_S1']*len(target_botnet), 'cx')
# plt.plot(features_normal[:,22], ['Normal_SF']*len(target_normal), 'go')
# plt.plot(features_botnet[:,22], ['Botnet_SF']*len(target_botnet), 'go')
# plt.plot(features_normal[:,23], ['Normal_REJ']*len(target_normal), 'k1')
# plt.plot(features_botnet[:,23], ['Botnet_REJ']*len(target_botnet), 'k1')
# plt.plot(features_normal[:,24], ['Normal_S2']*len(target_normal), 'm2')
# plt.plot(features_botnet[:,24], ['Botnet_S2']*len(target_botnet), 'm2')
# plt.plot(features_normal[:,25], ['Normal_S3']*len(target_normal), 'r3')
# plt.plot(features_botnet[:,25], ['Botnet_S3']*len(target_botnet), 'r3')
# plt.plot(features_normal[:,26], ['Normal_RSTO']*len(target_normal), 'y4')
# plt.plot(features_botnet[:,26], ['Botnet_RSTO']*len(target_botnet), 'y4')
# plt.plot(features_normal[:,27], ['Normal_RSTR']*len(target_normal), 'ys')
# plt.plot(features_botnet[:,27], ['Botnet_RSTR']*len(target_botnet), 'ys')
# plt.plot(features_normal[:,28], ['Normal_RSTOS0']*len(target_normal), 'bp')
# plt.plot(features_botnet[:,28], ['Botnet_RSTOS0']*len(target_botnet), 'bp')
# plt.plot(features_normal[:,29], ['Normal_RSTRH']*len(target_normal), 'c*')
# plt.plot(features_botnet[:,29], ['Botnet_RSTRH']*len(target_botnet), 'c*')
# plt.plot(features_normal[:,30], ['Normal_SH']*len(target_normal), 'gh')
# plt.plot(features_botnet[:,30], ['Botnet_SH']*len(target_botnet), 'gh')
# plt.plot(features_normal[:,31], ['Normal_SHR']*len(target_normal), 'kd')
# plt.plot(features_botnet[:,31], ['Botnet_SHR']*len(target_botnet), 'kd')
# plt.plot(features_normal[:,32], ['Normal_OTH']*len(target_normal), 'm+')
# plt.plot(features_botnet[:,32], ['Botnet_OTH']*len(target_botnet), 'm+')


#>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
#-----------------------------------------------------------------
#ssl_ratio
plt.figure(10)

plt.subplot()
plt.title('SSL Ratio (SLL/CONN)')
plt.xlabel('percentage')
plt.plot(features_normal[:,33], target_normal, '.')
plt.plot(features_botnet[:,33], target_botnet, '.')

#-----------------------------------------------------------------
#ssl_version_ratio: ['-', 'TLSv10', 'SSLv3', 'SSLv2']
plt.figure(11)

plt.subplot()
plt.title('SSL Version Ratio')
plt.xlabel('percentage')
plt.plot(features_normal[:,34], ['Normal_NOT_KOWN']*len(target_normal), 'b.')
plt.plot(features_botnet[:,34], ['Botnet_NOT_KOWN']*len(target_botnet), 'b.')
plt.plot(features_normal[:,35], ['Normal_TLSv10']*len(target_normal), 'cx')
plt.plot(features_botnet[:,35], ['Botnet_TLSv10']*len(target_botnet), 'cx')
plt.plot(features_normal[:,36], ['Normal_SSLv3']*len(target_normal), 'go')
plt.plot(features_botnet[:,36], ['Botnet_SSLv3']*len(target_botnet), 'go')
plt.plot(features_normal[:,37], ['Normal_SSLv2']*len(target_normal), 'k1')
plt.plot(features_botnet[:,37], ['Botnet_SSLv2']*len(target_botnet), 'k1')

#-----------------------------------------------------------------
#ssl_cipher_ratio: ['-', 'TLS_RSA_WITH_3DES_EDE_CBC_SHA', 'TLS_DH_ANON_WITH_RC4_128_MD5', 'TLS_DHE_RSA_WITH_AES_256_CBC_SHA', 'TLS_RSA_WITH_RC4_128_MD5', 'TLS_DHE_RSA_WITH_AES_128_CBC_SHA', 'TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA', 'TLS_ECDHE_RSA_WITH_RC4_128_SHA', 'TLS_RSA_EXPORT_WITH_RC4_40_MD5', 'TLS_RSA_WITH_RC4_128_SHA', 'TLS_RSA_WITH_CAMELLIA_256_CBC_SHA', 'TLS_RSA_WITH_AES_128_CBC_SHA', 'TLS_RSA_WITH_AES_256_CBC_SHA', 'TLS_DHE_RSA_WITH_CAMELLIA_256_CBC_SHA', 'TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA', 'SSLv20_CK_RC4_128_WITH_MD5', 'SSLv20_CK_DES_192_EDE3_CBC_WITH_MD5']
plt.figure(12)

#-----------------------------------------------------------------
#ssl_server_name_ratio: ['-', ip, noip]
plt.figure(13)

plt.subplot()
plt.title('SSL Server Name Ratio')
plt.xlabel('percentage')
plt.plot(features_normal[:,55], ['Normal_NOT_KOWN']*len(target_normal), 'b.')
plt.plot(features_botnet[:,55], ['Botnet_NOT_KOWN']*len(target_botnet), 'b.')
plt.plot(features_normal[:,56], ['Normal_IP']*len(target_normal), 'cx')
plt.plot(features_botnet[:,56], ['Botnet_IP']*len(target_botnet), 'cx')
plt.plot(features_normal[:,57], ['Normal_NOIP']*len(target_normal), 'go')
plt.plot(features_botnet[:,57], ['Botnet_NOIP']*len(target_botnet), 'go')

#-----------------------------------------------------------------
#ssl_resumed_ratio
plt.figure(14)

plt.title('SSL Resumed Ratio')
plt.xlabel('percentage')
plt.plot(features_normal[:,58], target_normal, '.')
plt.plot(features_botnet[:,58], target_botnet, '.')

#-----------------------------------------------------------------
#ssl_last_alert_ratio: ['-', 'unknown-218', 'unknown-156', 'bad_record_mac', 'bad_certificate', 'unknown-238', 'unrecognized_name', 'certificate_unknown', 'certificate_expired', 'unknown_ca', 'unknown-170', 'unknown-76', 'decrypt_error', 'unknown-58', 'unknown-7', 'handshake_failure', 'unexpected_message', 'close_notify']
plt.figure(15)




#-----------------------------------------------------------------
#ssl_established_ratio
plt.figure(16)

plt.title('SSL Established Ratio')
plt.xlabel('percentage')
plt.plot(features_normal[:,77], target_normal, '.')
plt.plot(features_botnet[:,77], target_botnet, '.')

#-----------------------------------------------------------------
#ssl_cert_chain_fuids: mean/standard deviation/standard deviation range
plt.figure(17)

plt.subplot(5,1,1)
plt.title('SSL Certificate Chain Fuids Mean')
plt.xlabel('time/ms')
plt.plot(features_normal[:,78], target_normal, '.')
plt.plot(features_botnet[:,78], target_botnet, '.')

plt.subplot(5,1,3)
plt.title('SSL Certificate Chain Fuids Standard Deviation')
plt.xlabel('time/ms')
plt.plot(features_normal[:,79], target_normal, '.')
plt.plot(features_botnet[:,79], target_botnet, '.')

plt.subplot(5,1,5)
plt.title('SSL Certificate Chain Fuids Standard Deviation Range')
plt.xlabel('percentage')
plt.plot(features_normal[:,80], target_normal, '.')
plt.plot(features_botnet[:,80], target_botnet, '.')

#-----------------------------------------------------------------
#ssl_validation_status_ratio: ['-', 'unable to get local issuer certificate', 'ok', 'self signed certificate in certificate chain', 'self signed certificate']
plt.figure(18)

plt.subplot()
plt.title('SSL Validation Status Ratio')
plt.xlabel('percentage')
plt.plot(features_normal[:,81], ['Normal_NOT_KOWN']*len(target_normal), 'b.')
plt.plot(features_botnet[:,81], ['Botnet_NOT_KOWN']*len(target_botnet), 'b.')
plt.plot(features_normal[:,82], ['Normal_unable']*len(target_normal), 'cx')
plt.plot(features_botnet[:,82], ['Botnet_unable']*len(target_botnet), 'cx')
plt.plot(features_normal[:,83], ['Normal_ok']*len(target_normal), 'go')
plt.plot(features_botnet[:,83], ['Botnet_ok']*len(target_botnet), 'go')
plt.plot(features_normal[:,84], ['Normal_self_in']*len(target_normal), 'k1')
plt.plot(features_botnet[:,84], ['Botnet_self_in']*len(target_botnet), 'k1')
plt.plot(features_normal[:,85], ['Normal_self']*len(target_normal), 'm2')
plt.plot(features_botnet[:,85], ['Botnet_self']*len(target_botnet), 'm2')

#-----------------------------------------------------------------
#ssl_cert_ratio
plt.figure(19)

plt.title('SSL Certificate Ratio')
plt.xlabel('percentage')
plt.plot(features_normal[:,86], target_normal, '.')
plt.plot(features_botnet[:,86], target_botnet, '.')


#>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>


plt.show()


