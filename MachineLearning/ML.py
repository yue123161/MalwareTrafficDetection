import glob
from sklearn.model_selection import cross_val_score
from sklearn import svm
from sklearn.linear_model import SGDClassifier
from sklearn import tree
from sklearn.ensemble import RandomForestClassifier, AdaBoostClassifier, GradientBoostingClassifier
from sklearn.neural_network import MLPClassifier


def read_features(feature_set_path):
    """
    read feature data into a list
    :param feature_set_path: the folder which keeps feature files
    :return: list
    """
    features = list()
    target = list()
    feature_paths = glob.glob(feature_set_path + "\\*")

    for path in feature_paths:
        with open(path) as f:
            for line in f:
                feature = list()
                split = line.split('\t')
                for cof in split:
                    if 'normal' in cof:
                        target.append('normal')
                    elif 'botnet' in cof:
                        target.append('botnet')
                    else:
                        feature.append(float(cof))
                features.append(feature)
            f.close()

    return features, target

def SVM_method(features, target):

    print(">>>applying SVM method")

    clf = svm.SVC()
    scores = cross_val_score(clf, features, target)
    print(scores.mean())


def SGD_method(features, target):

    print(">>>applying SGD method")

    clf = SGDClassifier(loss="hinge")
    scores = cross_val_score(clf, features, target)
    print(scores.mean())


def DT_method(features, target):

    print(">>>applying DT method")

    clf = tree.DecisionTreeClassifier()
    scores = cross_val_score(clf, features, target)
    print(scores.mean())


def RF_method(features, target):

    print(">>>applying RF method")

    clf = RandomForestClassifier(n_estimators=100)
    scores = cross_val_score(clf, features, target)
    print(scores.mean())


def AdaBoost_method(features, target):

    print(">>>applying AdaBoost method")

    clf = AdaBoostClassifier(n_estimators=100)
    scores = cross_val_score(clf, features, target)
    print(scores.mean())


def GradientTreeBoost_method(features, target):

    print(">>>applying Gradient Tree method")

    clf = GradientBoostingClassifier(n_estimators=100)
    scores = cross_val_score(clf, features, target)
    print(scores.mean())


def NN_method(features, target):

    print(">>>applying Neural Network method")

    clf = MLPClassifier()
    scores = cross_val_score(clf, features, target)
    print(scores.mean())


feature_set_path = "D:\\Work\PyCharm-workspace\\MalwareTrafficDetection\\Dataset\\features"
features, target = read_features(feature_set_path)

print("features number:", len(features))
SVM_method(features, target)
# SGD_method(features, target)
DT_method(features, target)
RF_method(features, target)
AdaBoost_method(features, target)
GradientTreeBoost_method(features, target)
NN_method(features, target)